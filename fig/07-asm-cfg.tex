\documentclass{lecturefig}
\begin{document}
\begin{frame}[fragile]
  \begin{tikzpicture}[
    bb/.style={align=left,font=\ttfamily,anchor=north west,
      text width=2.8cm, onslide=<4->{draw,yshift=-1em}},
    bb label/.style={bb,
      label={[anchor=north east]north west:.#1:},name=#1}
    ]

\node[bb label=BB0]{
        mov     EAX, 1\\
        cmp     ESI, 31\\
        jl      .BB3
      };
\node[below=0 of BB0.south west,bb,onslide=<4->{xshift=1cm}](BB1){
        mov     EAX, 3\\
        cmp     EDX, 14\\
        jl      .BB3
      };
\node[below=0 of BB1.south west,bb,onslide=<4->{xshift=1cm}](BB2){
  mov     EAX, 13
};
\node[below=0 of BB2.south west,bb label=BB3,onslide=<4->{xshift=-2cm}]{
        add     EAX, EAX\\
        inc     EDI\\
        jne     .BB3
      };
\node[below=0 of BB3.south west,bb](BB4){
  ret
};

\begin{visible}<2-3>
  \draw[draw,srared,thick] (BB3.north west) -- (BB3.north east);
\end{visible}

\begin{visible}<3>
  \draw[draw,srared,thick] (BB0.south west) -- (BB0.south east);
  \draw[draw,srared,thick] (BB1.south west) -- (BB1.south east);
  \draw[draw,srared,thick] (BB3.south west) -- (BB3.south east);
\end{visible}

\begin{visible}<4>
  \draw[->] (BB0) -- (BB1);
  \draw[->] (BB1) -- (BB2);
  \draw[->] (BB2) -- (BB3);
  \draw[->] ($(BB1.south west)+(east:2em)$) -- (BB3);
  \draw[->] (BB3) -- (BB4);
  \draw[->] (BB3) to[loop right] (BB3);
  \draw[->] ($(BB0.south west)+(east:1em)$) -- ($(BB3.north west)+(east:1em)$);

\end{visible}


    \end{tikzpicture}
  \end{frame}
\end{document}



    
  \end{tikzpicture}
\end{frame}
\end{document}
